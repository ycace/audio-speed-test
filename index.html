<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Local Audio Custom Playback Rate Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
        }

        .audio-block {
            margin-bottom: 24px;
            padding: 10px;
            border: 1px #eee solid;
            border-radius: 5px;
        }

        audio {
            vertical-align: middle;
        }

        .filename {
            font-family: monospace;
        }

        .adjust {
            margin-left: 10px;
            font-weight: bold;
        }

        .mult {
            font-family: monospace;
            color: #005;
        }

        #targetRateDisp {
            color: #007;
            font-weight: bold;
        }
    </style>
</head>

<body>
    <h1>Local Audio Custom Playback Rate Test</h1>
    <label>
        Target Playback Rate:
        <input id="targetRateInput" type="number" step="0.01" min="0.5" max="2" value="0.7" style="width:70px;">
        <span id="targetRateDisp">0.7</span>
    </label>
    <p style="font-size:0.95em;color:#555;">Each audio plays at the target rate with automatic speed/slow adjustment
        ratio displayed.</p>
    <div id="audioList"></div>
    <script>
        // Declare source rates
        const rates = [];
        for (let i = 0.6; i <= 1.0001; i += 0.05) {
            // Skip 0.85 (doesn't exist)
            if (Math.abs(i - 0.85) < 0.001) continue;
            // Skip 0.95 (doesn't exist)
            if (Math.abs(i - 0.95) < 0.001) continue;
            rates.push(Number(i.toFixed(2)));
        }
        function fileName(rate) { return `audio_test_x${rate}.wav`; }

        // Global cache for dynamic updates
        const audioBlocks = [];

        function getAdjustmentStr(rate, target) {
            const adjRatio = target / rate;
            let adjType = '';
            if (Math.abs(adjRatio - 1) < 0.01) { // Allow minor error
                adjType = 'Original rate, no adjustment';
            } else if (adjRatio > 1) {
                adjType = 'Speed up';
            } else {
                adjType = 'Slow down';
            }
            return { adjRatio: adjRatio, adjType: adjType };
        }

        const container = document.getElementById('audioList');
        function render(targetRate) {
            container.innerHTML = '';
            audioBlocks.length = 0;
            rates.forEach(rate => {
                const block = document.createElement('div');
                block.className = 'audio-block';

                // Rate adjustment analysis
                const { adjRatio, adjType } = getAdjustmentStr(rate, targetRate);

                const title = document.createElement('div');
                title.innerHTML = `<b>Source File Rate:</b> ${rate} (Filename: <span class="filename">${fileName(rate)}</span>)<span class="adjust">${adjType} <span class="mult">${adjRatio.toFixed(2)}x</span></span>`;

                // Audio element
                const audio = document.createElement('audio');
                audio.src = fileName(rate);
                audio.controls = true;
                audio.preload = 'none';
                audio.playbackRate = adjRatio;
                // Audio events
                const tip = document.createElement('span');
                tip.style.marginLeft = "12px";
                tip.style.color = "#555";

                block.append(title, audio, tip);
                container.appendChild(block);

                audioBlocks.push({ audio, title, rate }); // Cache
            });
        }

        // Initial render
        const targetRateInput = document.getElementById('targetRateInput');
        const targetRateDisp = document.getElementById('targetRateDisp');
        function updateAll() {
            let val = parseFloat(targetRateInput.value);
            if (isNaN(val) || val <= 0) val = 0.7;
            targetRateDisp.textContent = val;

            // Update blocks
            audioBlocks.forEach(block => {
                const { adjRatio, adjType } = getAdjustmentStr(block.rate, val);
                block.audio.playbackRate = adjRatio;
                block.title.innerHTML = `<b>Source File Rate:</b> ${block.rate} (Filename: <span class="filename">${fileName(block.rate)}</span>)<span class="adjust">${adjType} <span class="mult">${adjRatio.toFixed(2)}x</span></span>`;
            });
        }

        targetRateInput.addEventListener('input', () => {
            updateAll();
        });

        // First render
        render(parseFloat(targetRateInput.value));

    </script>
</body>

</html>